<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê—Ä–µ–Ω–∞ - Zone Control</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .arena-card {
            background: linear-gradient(135deg, #374151, #4b5563);
            border: 1px solid #6b7280;
            border-radius: 12px;
            transition: all 0.3s ease;
        }
        
        .arena-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }
        
        .arena-active {
            border-color: #22c55e;
            background: linear-gradient(135deg, #166534, #22c55e);
        }
        
        .arena-boss {
            border-color: #dc2626;
            background: linear-gradient(135deg, #991b1b, #dc2626);
        }
        
        .battle-timer {
            background: #374151;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .health-bar {
            background: #374151;
            border-radius: 10px;
            overflow: hidden;
            height: 12px;
        }
        
        .health-fill {
            background: linear-gradient(90deg, #22c55e, #16a34a);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .enemy-health-fill {
            background: linear-gradient(90deg, #dc2626, #b91c1c);
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .battle-action {
            background: linear-gradient(135deg, #d4a574, #b8956a);
            border: none;
            border-radius: 8px;
            color: #1a1a1a;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .battle-action:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(212, 165, 116, 0.4);
        }
        
        .battle-action:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .leaderboard-entry {
            background: linear-gradient(135deg, #2d3748, #4a5568);
            border: 1px solid #718096;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .leaderboard-entry.top-3 {
            border-color: #f59e0b;
            background: linear-gradient(135deg, #92400e, #f59e0b);
        }
        
        .reward-item {
            background: linear-gradient(135deg, #374151, #4b5563);
            border: 1px solid #6b7280;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .reward-item.claimed {
            opacity: 0.6;
            border-color: #22c55e;
        }
        
        .modal-overlay {
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1f2937, #374151);
            border: 1px solid #4b5563;
            border-radius: 16px;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-inter min-h-screen pb-20">
    <!-- –®–∞–ø–∫–∞ -->
    <header class="bg-gray-800/90 backdrop-blur-sm border-b border-gray-700 px-4 py-3">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <button onclick="window.location.href='index.html'" class="text-gray-400 hover:text-white">
                    ‚Üê –ù–∞–∑–∞–¥
                </button>
                <h1 class="font-orbitron text-xl font-bold text-yellow-400">–ê–†–ï–ù–ê</h1>
            </div>
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-2">
                    <span class="text-yellow-400 font-mono text-sm">üèÜ</span>
                    <span id="arena-rating" class="font-semibold">1,247</span>
                </div>
            </div>
        </div>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="p-4 space-y-6">
        <!-- –ë—ã—Å—Ç—Ä—ã–π –±–æ–π -->
        <div class="bg-gray-800/90 backdrop-blur-sm rounded-lg p-4">
            <h2 class="font-orbitron text-lg font-bold mb-4">–ë—ã—Å—Ç—Ä—ã–π –±–æ–π</h2>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
                <div class="arena-card p-4 cursor-pointer" onclick="startBattle('mutant')">
                    <div class="text-center">
                        <div class="text-3xl mb-2">üßü</div>
                        <div class="font-semibold text-sm">–ú—É—Ç–∞–Ω—Ç—ã</div>
                        <div class="text-xs text-gray-400">–°–ª–æ–∂–Ω–æ—Å—Ç—å: ‚òÖ‚òÖ‚òÜ</div>
                        <div class="text-xs text-green-400 mt-1">–ù–∞–≥—Ä–∞–¥–∞: ‚ÇΩ50-100</div>
                    </div>
                </div>
                
                <div class="arena-card p-4 cursor-pointer" onclick="startBattle('bandit')">
                    <div class="text-center">
                        <div class="text-3xl mb-2">üíÄ</div>
                        <div class="font-semibold text-sm">–ë–∞–Ω–¥–∏—Ç—ã</div>
                        <div class="text-xs text-gray-400">–°–ª–æ–∂–Ω–æ—Å—Ç—å: ‚òÖ‚òÖ‚òÖ</div>
                        <div class="text-xs text-green-400 mt-1">–ù–∞–≥—Ä–∞–¥–∞: ‚ÇΩ75-150</div>
                    </div>
                </div>
                
                <div class="arena-card arena-boss p-4 cursor-pointer" onclick="startBattle('boss')">
                    <div class="text-center">
                        <div class="text-3xl mb-2">üëπ</div>
                        <div class="font-semibold text-sm">–ë–æ—Å—Å</div>
                        <div class="text-xs text-red-400">–°–ª–æ–∂–Ω–æ—Å—Ç—å: ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <div class="text-xs text-yellow-400 mt-1">–ù–∞–≥—Ä–∞–¥–∞: –ê—Ä—Ç–µ—Ñ–∞–∫—Ç</div>
                    </div>
                </div>
                
                <div class="arena-card p-4 cursor-pointer" onclick="startBattle('horde')">
                    <div class="text-center">
                        <div class="text-3xl mb-2">üë•</div>
                        <div class="font-semibold text-sm">–û—Ä–¥–∞</div>
                        <div class="text-xs text-gray-400">–°–ª–æ–∂–Ω–æ—Å—Ç—å: ‚òÖ‚òÖ‚òÖ‚òÖ</div>
                        <div class="text-xs text-green-400 mt-1">–ù–∞–≥—Ä–∞–¥–∞: ‚ÇΩ100-200</div>
                    </div>
                </div>
            </div>
            
            <div class="bg-blue-600/20 border border-blue-600 rounded-lg p-3">
                <div class="flex items-center justify-between">
                    <div>
                        <div class="font-semibold text-sm">–ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è –∞—Ä–µ–Ω–∞</div>
                        <div class="text-xs text-gray-400">5 –±–æ—ë–≤ –¥–æ –Ω–∞–≥—Ä–∞–¥—ã</div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm font-semibold text-blue-400">3/5</div>
                        <div class="text-xs text-gray-400">–ø–æ–±–µ–¥</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –¢–µ–∫—É—â–∏–π –±–æ–π -->
        <div id="battle-screen" class="bg-gray-800/90 backdrop-blur-sm rounded-lg p-4 hidden">
            <h2 class="font-orbitron text-lg font-bold mb-4">–ë–æ–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ</h2>
            
            <div class="grid grid-cols-2 gap-4 mb-4">
                <!-- –ò–≥—Ä–æ–∫ -->
                <div class="text-center">
                    <div class="text-4xl mb-2">üßë‚ÄçüöÄ</div>
                    <div class="font-semibold mb-2">–í—ã</div>
                    <div class="health-bar mb-2">
                        <div id="player-health" class="health-fill" style="width: 100%"></div>
                    </div>
                    <div class="text-sm text-gray-400">100/100 HP</div>
                </div>
                
                <!-- –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ -->
                <div class="text-center">
                    <div id="enemy-icon" class="text-4xl mb-2">üßü</div>
                    <div id="enemy-name" class="font-semibold mb-2">–ú—É—Ç–∞–Ω—Ç</div>
                    <div class="health-bar mb-2">
                        <div id="enemy-health" class="enemy-health-fill" style="width: 100%"></div>
                    </div>
                    <div id="enemy-hp" class="text-sm text-gray-400">150/150 HP</div>
                </div>
            </div>
            
            <!-- –ë–æ–µ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
            <div class="grid grid-cols-2 gap-3 mb-4">
                <button class="battle-action py-2 text-sm" onclick="playerAction('attack')">
                    ‚öîÔ∏è –ê—Ç–∞–∫–æ–≤–∞—Ç—å
                </button>
                <button class="battle-action py-2 text-sm" onclick="playerAction('defend')">
                    üõ°Ô∏è –ó–∞—â–∏—â–∞—Ç—å—Å—è
                </button>
                <button class="battle-action py-2 text-sm" onclick="playerAction('special')">
                    ‚ö° –°–ø–µ—Ü—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å
                </button>
                <button class="battle-action py-2 text-sm" onclick="playerAction('item')">
                    üíä –ü—Ä–µ–¥–º–µ—Ç
                </button>
            </div>
            
            <!-- –õ–æ–≥ –±–æ—è -->
            <div id="battle-log" class="bg-gray-700/50 rounded-lg p-3 h-24 overflow-y-auto text-sm">
                <div class="text-gray-400">–ë–æ–π –Ω–∞—á–∞–ª—Å—è...</div>
            </div>
        </div>

        <!-- –†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ -->
        <div class="bg-gray-800/90 backdrop-blur-sm rounded-lg p-4">
            <h2 class="font-orbitron text-lg font-bold mb-4">–†–µ–π—Ç–∏–Ω–≥–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞</h2>
            
            <div class="space-y-3">
                <div class="leaderboard-entry top-3 p-3">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="font-bold text-yellow-400">1</span>
                            <div>
                                <div class="font-semibold text-sm">ArenaMaster</div>
                                <div class="text-xs text-gray-400">–£—Ä–æ–≤–µ–Ω—å 15 ‚Ä¢ 89 –ø–æ–±–µ–¥</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-semibold text-sm">3,247 –æ—á–∫–æ–≤</div>
                            <div class="text-xs text-yellow-400">‚≠ê –õ–µ–≥–µ–Ω–¥–∞</div>
                        </div>
                    </div>
                </div>
                
                <div class="leaderboard-entry top-3 p-3">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="font-bold text-gray-400">2</span>
                            <div>
                                <div class="font-semibold text-sm">Gladiator</div>
                                <div class="text-xs text-gray-400">–£—Ä–æ–≤–µ–Ω—å 12 ‚Ä¢ 67 –ø–æ–±–µ–¥</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-semibold text-sm">2,891 –æ—á–∫–æ–≤</div>
                            <div class="text-xs text-gray-400">üíé –ú–∞—Å—Ç–µ—Ä</div>
                        </div>
                    </div>
                </div>
                
                <div class="leaderboard-entry top-3 p-3">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="font-bold text-orange-400">3</span>
                            <div>
                                <div class="font-semibold text-sm">Warrior</div>
                                <div class="text-xs text-gray-400">–£—Ä–æ–≤–µ–Ω—å 10 ‚Ä¢ 45 –ø–æ–±–µ–¥</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-semibold text-sm">2,456 –æ—á–∫–æ–≤</div>
                            <div class="text-xs text-gray-400">üèÜ –≠–∫—Å–ø–µ—Ä—Ç</div>
                        </div>
                    </div>
                </div>
                
                <div class="leaderboard-entry p-3">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <span class="font-bold text-blue-400">8</span>
                            <div>
                                <div class="font-semibold text-sm">–í—ã</div>
                                <div class="text-xs text-gray-400">–£—Ä–æ–≤–µ–Ω—å 5 ‚Ä¢ 12 –ø–æ–±–µ–¥</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="font-semibold text-sm">1,247 –æ—á–∫–æ–≤</div>
                            <div class="text-xs text-gray-400">‚ö° –ë–æ–µ—Ü</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ù–∞–≥—Ä–∞–¥—ã –∑–∞ –∞—Ä–µ–Ω—É -->
        <div class="bg-gray-800/90 backdrop-blur-sm rounded-lg p-4">
            <h2 class="font-orbitron text-lg font-bold mb-4">–ù–∞–≥—Ä–∞–¥—ã –∑–∞ –∞—Ä–µ–Ω—É</h2>
            
            <div class="grid grid-cols-2 gap-3">
                <div class="reward-item p-3">
                    <div class="text-center">
                        <div class="text-2xl mb-2">üèÜ</div>
                        <div class="font-semibold text-sm">5 –ø–æ–±–µ–¥</div>
                        <div class="text-xs text-gray-400">‚ÇΩ500 + –∞—Ä—Ç–µ—Ñ–∞–∫—Ç</div>
                    </div>
                </div>
                
                <div class="reward-item p-3">
                    <div class="text-center">
                        <div class="text-2xl mb-2">üíé</div>
                        <div class="font-semibold text-sm">10 –ø–æ–±–µ–¥</div>
                        <div class="text-xs text-gray-400">‚ÇΩ1000 + —Ä–µ–¥–∫–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç</div>
                    </div>
                </div>
                
                <div class="reward-item claimed p-3">
                    <div class="text-center">
                        <div class="text-2xl mb-2">‚ö°</div>
                        <div class="font-semibold text-sm">15 –ø–æ–±–µ–¥</div>
                        <div class="text-xs text-gray-400">‚ÇΩ1500 + —ç–ø–∏–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç</div>
                        <div class="text-xs text-green-400 mt-1">‚úì –ü–æ–ª—É—á–µ–Ω–æ</div>
                    </div>
                </div>
                
                <div class="reward-item p-3">
                    <div class="text-center">
                        <div class="text-2xl mb-2">üî•</div>
                        <div class="font-semibold text-sm">25 –ø–æ–±–µ–¥</div>
                        <div class="text-xs text-gray-400">‚ÇΩ2500 + –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- –ù–∏–∂–Ω—è—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="fixed bottom-0 left-0 right-0 bg-gray-800/95 backdrop-blur-sm border-t border-gray-700 px-4 py-2 z-50">
        <div class="flex items-center justify-around">
            <button class="flex flex-col items-center space-y-1 text-gray-400" onclick="window.location.href='index.html'">
                <div class="w-6 h-6 bg-gray-600 rounded"></div>
                <span class="text-xs">–ö–∞—Ä—Ç–∞</span>
            </button>
            <button class="flex flex-col items-center space-y-1 text-gray-400" onclick="window.location.href='faction.html'">
                <div class="w-6 h-6 bg-gray-600 rounded"></div>
                <span class="text-xs">–§—Ä–∞–∫—Ü–∏—è</span>
            </button>
            <button class="flex flex-col items-center space-y-1 text-gray-400" onclick="window.location.href='inventory.html'">
                <div class="w-6 h-6 bg-gray-600 rounded"></div>
                <span class="text-xs">–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å</span>
            </button>
            <button class="flex flex-col items-center space-y-1 text-gray-400" onclick="window.location.href='social.html'">
                <div class="w-6 h-6 bg-gray-600 rounded"></div>
                <span class="text-xs">–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ</span>
            </button>
            <button class="flex flex-col items-center space-y-1 text-blue-400">
                <div class="w-6 h-6 bg-blue-600 rounded"></div>
                <span class="text-xs">–ê—Ä–µ–Ω–∞</span>
            </button>
        </div>
    </nav>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –±–æ—è -->
    <div id="battle-result-modal" class="modal-overlay fixed inset-0 z-50 flex items-center justify-center hidden">
        <div class="modal-content max-w-md w-full mx-4 p-6">
            <div class="text-center">
                <div id="result-icon" class="text-6xl mb-4">üèÜ</div>
                <h2 id="result-title" class="font-orbitron text-2xl font-bold mb-2">–ü–æ–±–µ–¥–∞!</h2>
                <p id="result-description" class="text-gray-300 mb-4">–í—ã –ø–æ–±–µ–¥–∏–ª–∏ –º—É—Ç–∞–Ω—Ç–∞!</p>
                
                <div id="result-rewards" class="bg-gray-700/50 rounded-lg p-4 mb-4">
                    <div class="text-sm text-green-400">+‚ÇΩ75</div>
                    <div class="text-sm text-blue-400">+10 —Ä–µ–ø—É—Ç–∞—Ü–∏–∏</div>
                    <div class="text-sm text-purple-400">–ù–∞–π–¥–µ–Ω –ø—Ä–µ–¥–º–µ—Ç: –ë–∞—Ç–∞—Ä–µ–π–∫–∞</div>
                </div>
                
                <div class="flex space-x-3">
                    <button onclick="closeBattleResult()" class="battle-action flex-1 py-2">–ó–∞–∫—Ä—ã—Ç—å</button>
                    <button onclick="startNextBattle()" class="bg-gray-600 flex-1 py-2 rounded">–°–ª–µ–¥—É—é—â–∏–π –±–æ–π</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let battleState = {
            inProgress: false,
            playerHealth: 100,
            enemyHealth: 150,
            enemyType: '',
            turn: 'player'
        };
        
        // –ù–∞—á–∞—Ç—å –±–æ–π
        function startBattle(type) {
            const battleTypes = {
                'mutant': { name: '–ú—É—Ç–∞–Ω—Ç', health: 150, icon: 'üßü', reward: { money: [50, 100], reputation: 10 } },
                'bandit': { name: '–ë–∞–Ω–¥–∏—Ç', health: 120, icon: 'üíÄ', reward: { money: [75, 150], reputation: 15 } },
                'boss': { name: '–ë–æ—Å—Å', health: 300, icon: 'üëπ', reward: { money: [200, 500], reputation: 50, artifact: true } },
                'horde': { name: '–û—Ä–¥–∞', health: 250, icon: 'üë•', reward: { money: [100, 200], reputation: 25 } }
            };
            
            const enemy = battleTypes[type];
            if (!enemy) return;
            
            battleState = {
                inProgress: true,
                playerHealth: 100,
                enemyHealth: enemy.health,
                enemyType: type,
                enemyData: enemy,
                turn: 'player'
            };
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —ç–∫—Ä–∞–Ω –±–æ—è
            document.getElementById('battle-screen').classList.remove('hidden');
            
            // –û–±–Ω–æ–≤–∏—Ç—å UI –±–æ—è
            document.getElementById('enemy-icon').textContent = enemy.icon;
            document.getElementById('enemy-name').textContent = enemy.name;
            document.getElementById('enemy-hp').textContent = `${enemy.health}/${enemy.health} HP`;
            
            // –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥ –±–æ—è
            document.getElementById('battle-log').innerHTML = '<div class="text-gray-400">–ë–æ–π –Ω–∞—á–∞–ª—Å—è...</div>';
            
            addBattleLog(`–í—ã –≤—Å—Ç—Ä–µ—á–∞–µ—Ç–µ ${enemy.name}!`);
        }
        
        // –î–µ–π—Å—Ç–≤–∏–µ –∏–≥—Ä–æ–∫–∞
        function playerAction(action) {
            if (!battleState.inProgress || battleState.turn !== 'player') return;
            
            const actions = {
                'attack': { damage: [20, 35], text: '–ê—Ç–∞–∫—É–µ—Ç–µ' },
                'defend': { damage: [0, 0], text: '–ó–∞—â–∏—â–∞–µ—Ç–µ—Å—å', defense: true },
                'special': { damage: [40, 60], text: '–ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å–ø–µ—Ü—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å', cooldown: true },
                'item': { damage: [15, 25], text: '–ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–µ–¥–º–µ—Ç', heal: 20 }
            };
            
            const playerAction = actions[action];
            let damage = 0;
            
            if (playerAction.damage[0] > 0) {
                damage = Math.floor(Math.random() * (playerAction.damage[1] - playerAction.damage[0] + 1)) + playerAction.damage[0];
                battleState.enemyHealth -= damage;
                addBattleLog(`–í—ã ${playerAction.text.toLowerCase()} –∏ –Ω–∞–Ω–æ—Å–∏—Ç–µ ${damage} —É—Ä–æ–Ω–∞!`);
            } else if (playerAction.heal) {
                battleState.playerHealth = Math.min(100, battleState.playerHealth + playerAction.heal);
                addBattleLog(`–í—ã ${playerAction.text.toLowerCase()} –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç–µ ${playerAction.heal} HP!`);
                updateBattleUI();
            } else {
                addBattleLog(`–í—ã ${playerAction.text.toLowerCase()}!`);
            }
            
            if (damage > 0) {
                addBattleLog(`${battleState.enemyData.name} —Ç–µ—Ä—è–µ—Ç ${damage} HP!`);
            }
            
            updateBattleUI();
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–±–µ–¥—É
            if (battleState.enemyHealth <= 0) {
                endBattle(true);
                return;
            }
            
            // –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
            battleState.turn = 'enemy';
            setTimeout(() => {
                enemyTurn();
            }, 1500);
        }
        
        // –•–æ–¥ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
        function enemyTurn() {
            if (!battleState.inProgress) return;
            
            const damage = Math.floor(Math.random() * 25) + 15;
            battleState.playerHealth -= damage;
            
            addBattleLog(`${battleState.enemyData.name} –∞—Ç–∞–∫—É–µ—Ç –∏ –Ω–∞–Ω–æ—Å–∏—Ç ${damage} —É—Ä–æ–Ω–∞!`);
            addBattleLog(`–í—ã —Ç–µ—Ä—è–µ—Ç–µ ${damage} HP!`);
            
            updateBattleUI();
            
            // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Ä–∞–∂–µ–Ω–∏–µ
            if (battleState.playerHealth <= 0) {
                endBattle(false);
                return;
            }
            
            // –í–µ—Ä–Ω—É—Ç—å —Ö–æ–¥ –∏–≥—Ä–æ–∫—É
            battleState.turn = 'player';
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å UI –±–æ—è
        function updateBattleUI() {
            const playerHealthPercent = Math.max(0, (battleState.playerHealth / 100) * 100);
            const enemyHealthPercent = Math.max(0, (battleState.enemyHealth / battleState.enemyData.health) * 100);
            
            document.getElementById('player-health').style.width = `${playerHealthPercent}%`;
            document.getElementById('enemy-health').style.width = `${enemyHealthPercent}%`;
            
            // –û–±–Ω–æ–≤–∏—Ç—å HP —Ç–µ–∫—Å—Ç
            document.querySelector('#battle-screen .text-sm.text-gray-400').textContent = `${battleState.playerHealth}/100 HP`;
            document.getElementById('enemy-hp').textContent = `${battleState.enemyHealth}/${battleState.enemyData.health} HP`;
        }
        
        // –î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–≥ –±–æ—è
        function addBattleLog(message) {
            const log = document.getElementById('battle-log');
            const entry = document.createElement('div');
            entry.textContent = message;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }
        
        // –ó–∞–∫–æ–Ω—á–∏—Ç—å –±–æ–π
        function endBattle(victory) {
            battleState.inProgress = false;
            
            // –°–∫—Ä—ã—Ç—å —ç–∫—Ä–∞–Ω –±–æ—è
            document.getElementById('battle-screen').classList.add('hidden');
            
            // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
            showBattleResult(victory);
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–æ—è
        function showBattleResult(victory) {
            const modal = document.getElementById('battle-result-modal');
            const icon = document.getElementById('result-icon');
            const title = document.getElementById('result-title');
            const description = document.getElementById('result-description');
            const rewards = document.getElementById('result-rewards');
            
            if (victory) {
                icon.textContent = 'üèÜ';
                title.textContent = '–ü–æ–±–µ–¥–∞!';
                description.textContent = `–í—ã –ø–æ–±–µ–¥–∏–ª–∏ ${battleState.enemyData.name}!`;
                
                // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–∞–≥—Ä–∞–¥—ã
                const moneyReward = Math.floor(Math.random() * 
                    (battleState.enemyData.reward.money[1] - battleState.enemyData.reward.money[0] + 1)) + 
                    battleState.enemyData.reward.money[0];
                const reputationReward = battleState.enemyData.reward.reputation;
                
                rewards.innerHTML = `
                    <div class="text-sm text-green-400">+‚ÇΩ${moneyReward}</div>
                    <div class="text-sm text-blue-400">+${reputationReward} —Ä–µ–ø—É—Ç–∞—Ü–∏–∏</div>
                    <div class="text-sm text-purple-400">–ù–∞–π–¥–µ–Ω –ø—Ä–µ–¥–º–µ—Ç: –ë–∞—Ç–∞—Ä–µ–π–∫–∞</div>
                `;
                
                // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                updatePlayerStatsAfterBattle(moneyReward, reputationReward);
            } else {
                icon.textContent = 'üíÄ';
                title.textContent = '–ü–æ—Ä–∞–∂–µ–Ω–∏–µ';
                description.textContent = `–í–∞—Å –ø–æ–±–µ–¥–∏–ª ${battleState.enemyData.name}!`;
                rewards.innerHTML = '<div class="text-sm text-gray-400">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!</div>';
            }
            
            modal.classList.remove('hidden');
        }
        
        // –ó–∞–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–æ—è
        function closeBattleResult() {
            document.getElementById('battle-result-modal').classList.add('hidden');
        }
        
        // –ù–∞—á–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π –±–æ–π
        function startNextBattle() {
            closeBattleResult();
            startBattle(battleState.enemyType);
        }
        
        // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏–≥—Ä–æ–∫–∞ –ø–æ—Å–ª–µ –±–æ—è
        function updatePlayerStatsAfterBattle(money, reputation) {
            // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ localStorage
            const savedMoney = parseInt(localStorage.getItem('playerMoney') || '0');
            const savedReputation = parseInt(localStorage.getItem('playerReputation') || '0');
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è
            const newMoney = savedMoney + money;
            const newReputation = savedReputation + reputation;
            
            // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
            localStorage.setItem('playerMoney', newMoney.toString());
            localStorage.setItem('playerReputation', newReputation.toString());
            
            // –û–±–Ω–æ–≤–∏—Ç—å UI –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
            if (window.opener) {
                window.opener.postMessage('updateStats', '*');
            }
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            // –û–±–Ω–æ–≤–∏—Ç—å —Ä–µ–π—Ç–∏–Ω–≥ –∏–∑ localStorage
            const savedRating = localStorage.getItem('arenaRating');
            if (savedRating) {
                document.getElementById('arena-rating').textContent = savedRating;
            }
        });
    </script>
</body>
</html>